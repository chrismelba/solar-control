{% extends "base.html" %}

{% block title %}Solar Control Dashboard{% endblock %}

{% block heading %}Solar Control Dashboard{% endblock %}

{% block content %}
    <div class="nav-menu">
        <a href="{{ url_for('configure_solar') }}" class="button">Configure Solar</a>
        <a href="{{ url_for('configure_battery') }}" class="button">Configure Battery</a>
        <a href="{{ url_for('configure_devices') }}" class="button">Configure Devices</a>
    </div>
    
    <div class="card" id="sensor-values">
        <h2>Current Sensor Values</h2>
        <div class="sensor-grid">
            <div class="sensor-card">
                <h3>Solar Generation</h3>
                {% if sensor_values.solar_generation %}
                    <p class="value">{{ sensor_values.solar_generation.state }} {{ sensor_values.solar_generation.unit }}</p>
                    <p class="name">{{ sensor_values.solar_generation.friendly_name }}</p>
                {% else %}
                    <p class="value">Not configured</p>
                {% endif %}
            </div>
            
            <div class="sensor-card">
                <h3>Grid Power</h3>
                {% if sensor_values.grid_power %}
                    <p class="value">{{ sensor_values.grid_power.state }} {{ sensor_values.grid_power.unit }}</p>
                    <p class="name">{{ sensor_values.grid_power.friendly_name }}</p>
                {% else %}
                    <p class="value">Not configured</p>
                {% endif %}
            </div>
            
            <div class="sensor-card">
                <h3>Solar Forecast</h3>
                {% if sensor_values.solar_forecast %}
                    <p class="value">{{ sensor_values.solar_forecast.state }} {{ sensor_values.solar_forecast.unit }}</p>
                    <p class="name">{{ sensor_values.solar_forecast.friendly_name }}</p>
                {% else %}
                    <p class="value">Not configured</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card" id="status">
        <h2>System Status</h2>
        <p>Loading status...</p>
    </div>

    <style>
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .sensor-card {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        .sensor-card h3 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }
        .sensor-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
            color: #2196F3;
        }
        .sensor-card .name {
            font-size: 0.9rem;
            color: #666;
            margin: 0;
        }
    </style>

    <script>
        // Fetch status from API
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                document.querySelector('#status p').textContent = 
                    `Status: ${data.status}, Version: ${data.version}`;
            })
            .catch(error => {
                document.querySelector('#status p').textContent = 
                    'Error loading status';
            });
    </script>
{% endblock %} 